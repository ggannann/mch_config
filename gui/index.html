<!DOCTYPE html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>MCH config</title>
  </head>
  <body>

  <div>
    <table>
      <tr>
        <td>Target Moxa</td>
        <td>
          <input required pattern="^([0-9]{1,3}\.){3}[0-9]{1,3}$" id="ipaddr" value="10.0.5.55">
        </td>
      </tr>
      <tr>
        <td>Firmware Version</td>
        <td> <input type="text" id="fwVer" value="2.20.4"> </td>
      </tr>
    </table>
  </div>

  <table class="selectableOpts">
  <thead>
    <tr>
      <th>Num</th>
      <th>Select</th>
      <th>3U</th>
      <th>NA</th>
      <th>9U</th>
      <th></th>
      <th>Num</th>
      <th>Select</th>
      <th>3U</th>
      <th>NA</th>
      <th>9U</th>
    </tr>
  </thead>
  <tbody>
    <!-- Select all row !-->
    <tr>
      <td> L </td>
      <td> <input class="SelectAllL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioAllL" type="radio" name="clockSelectL" value="3U"></td>
      <td> <input class="RadioAllL" type="radio" name="clockSelectL" value="NA"></td>
      <td> <input class="RadioAllL" type="radio" name="clockSelectL" value="9U"></td>

      <td></td>

      <td> R </td>
      <td> <input class="SelectAllR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioAllR" type="radio" name="clockSelectR" value="3U"></td>
      <td> <input class="RadioAllR" type="radio" name="clockSelectR" value="NA"></td>
      <td> <input class="RadioAllR" type="radio" name="clockSelectR" value="9U"></td>
    </tr>

    <tr> </tr>
    <tr> </tr>

    <!-- Row 1 & 17 !-->
    <tr>
      <td> 1 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r1" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r1" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r1" value="9U"></td>

      <td></td>

      <td> 17</td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r1" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r1" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r1" value="9U"></td>
    </tr>

    <!-- Row 2 & 18 !-->
    <tr>
      <td> 2 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r2" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r2" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r2" value="9U"></td>

      <td></td>

      <td> 18 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r2" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r2" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r2" value="9U"></td>
    </tr>

    <!-- Row 3 & 19 !-->
    <tr>
      <td> 3 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r3" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r3" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r3" value="9U"></td>

      <td></td>

      <td> 19 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r3" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r3" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r3" value="9U"></td>
    </tr>

    <!-- Row 4 & 20 !-->
    <tr>
      <td> 4 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r4" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r4" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r4" value="9U"></td>

      <td></td>

      <td> 20 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r4" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r4" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r4" value="9U"></td>
    </tr>

    <!-- Row 5 & 21 !-->
    <tr>
      <td> 5 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r5" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r5" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r5" value="9U"></td>

      <td></td>

      <td> 21 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r5" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r5" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r5" value="9U"></td>
    </tr>

    <!-- Row 6 & 22 !-->
    <tr>
      <td> 6 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r6" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r6" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r6" value="9U"></td>

      <td></td>

      <td> 22 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r6" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r6" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r6" value="9U"></td>
    </tr>

    <!-- Row 7 & 23 !-->
    <tr>
      <td> 7 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r7" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r7" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r7" value="9U"></td>

      <td></td>

      <td> 23 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r7" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r7" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r7" value="9U"></td>
    </tr>

    <!-- Row 8 & 24 !-->
    <tr>
      <td> 8 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r8" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r8" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r8" value="9U"></td>

      <td></td>

      <td> 24 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r8" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r8" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r8" value="9U"></td>
    </tr>

    <!-- Row 9 & 25 !-->
    <tr>
      <td> 9 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r9" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r9" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r9" value="9U"></td>

      <td></td>

      <td> 25 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r9" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r9" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r9" value="9U"></td>
    </tr>

    <!-- Row 10 & 26 !-->
    <tr>
      <td> 10 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r10" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r10" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r10" value="9U"></td>

      <td></td>

      <td> 26 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r10" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r10" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r10" value="9U"></td>
    </tr>

    <!-- Row 11 & 27 !-->
    <tr>
      <td> 11 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r11" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r11" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r11" value="9U"></td>

      <td></td>

      <td> 27 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r11" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r11" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r11" value="9U"></td>
    </tr>

    <!-- Row 12 & 28 !-->
    <tr>
      <td> 12 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r12" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r12" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r12" value="9U"></td>

      <td></td>

      <td> 28 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r12" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r12" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r12" value="9U"></td>
    </tr>

    <!-- Row 13 & 29 !-->
    <tr>
      <td> 13 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r13" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r13" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r13" value="9U"></td>

      <td></td>

      <td> 29 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r13" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r13" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r13" value="9U"></td>
    </tr>

    <!-- Row 14 & 30 !-->
    <tr>
      <td> 14 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r14" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r14" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r14" value="9U"></td>

      <td></td>

      <td> 30 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r14" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r14" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r14" value="9U"></td>
    </tr>

    <!-- Row 15 & 31 !-->
    <tr>
      <td> 15 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r15" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r15" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r15" value="9U"></td>

      <td></td>

      <td> 31 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r15" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r15" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r15" value="9U"></td>
    </tr>

    <!-- Row 16 & 32 !-->
    <tr>
      <td> 16 </td>
      <td> <input class="SelectL" type="checkbox" name="selectA" value="select"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r16" value="3U"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r16" value="NA" checked="checked"></td>
      <td> <input class="RadioL" type="radio" name="clockSelectL-r16" value="9U"></td>

      <td></td>

      <td> 32 </td>
      <td> <input class="SelectR" type="checkbox" name="selectB" value="select"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r16" value="3U"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r16" value="NA" checked="checked"></td>
      <td> <input class="RadioR" type="radio" name="clockSelectR-r16" value="9U"></td>
    </tr>

  </tbody>
  </table>

  <div>
     <button id="SendButton" name = "Send" value = "OK" type = "button">Send</button>
  </div>



  <script>
  //https://github.com/joewalnes/websocketd
  //https://github.com/joewalnes/websocketd/wiki/Websocketd-on-Raspberry-Pi
  var ws = new WebSocket('ws://localhost:8080/');

  ws.onopen = function() {
  document.body.style.backgroundColor = '#cfc';
  };
  ws.onclose = function() {
  document.body.style.backgroundColor = null;
  };
  ws.onerror = function(evt) {
  $('#wsresults').html('Error: '+event.data);
  };
  ws.onmessage = function(event) {
  $('#wsresults').html(event.data);
  };

  $(document).ready(function() {
    // Logic to manage webui buttons +++++++++++++++++++++++++++++++++++++++++++

    // General select: This button enables or disables all the column.

    // Left column -- check button
    $(".SelectAllL").click(function() {
     if ($(this).prop("checked") == true) {
       $(".SelectL").prop("checked", true);
     } else {
       $(".SelectL").prop("checked", false);
       $(".RadioAllL").prop("checked", false);
       $(".RadioL").prop("checked", false);
     }
    });

    $(".SelectL").click(function() {
      $(".SelectAllL").prop("checked", false);
    });

    // Left column -- radio button
    $(".RadioAllL").click(function() {
     if ($(this).prop("checked") == true) {
        if($(this).attr("value") == "3U") {
          $(".RadioL[value=3U]").prop("checked", true);
        }
        else {
          $(".RadioL[value=9U]").prop("checked", true);
        }
     }
    });

     // Right column -- check button
     $(".SelectAllR").click(function() {
       if ($(this).prop("checked") == true) {
         $(".SelectR").prop("checked", true);
       } else {
         $(".SelectR").prop("checked", false);
         $(".RadioAllR").prop("checked", false);
         $(".RadioR").prop("checked", false);
       }
     });

     $(".SelectR").click(function() {
        $(".SelectAllR").prop("checked", false);
     });

     // Right column -- radio button
     $(".RadioAllR").click(function() {
       if ($(this).prop("checked") == true) {
          if($(this).attr("value") == "3U") {
            $(".RadioR[value=3U]").prop("checked", true);
          }
          else {
            $(".RadioR[value=9U]").prop("checked", true);
          }
       }
     });

     // Logic to run the Bash script in the server +++++++++++++++++++++++++++++

    $("#SendButton").on('click', function(e) {
     //alert("Tu que lo vas a mandar");
     //if (ws) {
     var listSelected = [];
     listSelected["NoU"] = "";
     listSelected["3U"] = "";
     listSelected["9U"] = "";
     if (true) { // Let's play like this for a while
       // Collect data from the buttons in order to call the Bash script
       var it = 1;
       $(".SelectL").each(function() {
         if($(this).prop("checked")) {
          var formFactor = $(".RadioL[name=clockSelectL-r"+it+"]:checked").attr("value");
          listSelected[formFactor] += it + ","
         }
         it++;
       });

       it = 17;
       var k = 1;
       $(".SelectR").each(function() {
         if($(this).prop("checked")) {
          var formFactor = $(".RadioR[name=clockSelectR-r"+k+"]:checked").attr("value");
          listSelected[formFactor] += it + ","
         }
         it++;
         k++;
       });

       // Let's make the commands to run in the server
       // For example: mch_config 10.0.5.55 1,2,3, 3U -s 1,2,3,4,5
       var config3U = "";
       var config9U = "";
       var configNA = "";

       if(listSelected["3U"] != "") {
         config3U = "mch_config " + $("#ipaddr").val() + " " +
                    listSelected["3U"] + " 3U " + "-s 1,2,3,4,5"
       }


       if(listSelected["9U"] != "") {
         config3U = "mch_config " + $(".ipaddr").val() + " " +
                    listSelected["9U"] + " 9U " + "-s 1,2,3,4,5"
       }

       // If step 5 is not specified, the form factor is not really take into
       // account in the Bash script
       if(listSelected["NA"] != "") {
         config3U = "mch_config " + $(".ipaddr").val() + " " +
                    listSelected["NA"] + " 3U " + "-s 1,2,3,"
       }
       try {
         if(config3U != "") ws.send(config3U);
         if(config9U != "") ws.send(config3U);
         if(configNA != "") ws.send(config3U);
       } catch (ex) {
         alert("Cannot send: " + ex);
       }
     }
    });

  });

  </script>

  </body>
</html>
